import csv
import pandas as pd
import numpy as np

csvFile1 = pd.read_csv('OasisLMF/Taxonomies/UniqueMappedOEDcodes.csv')  
df1 = pd.DataFrame(csvFile1).to_numpy()

csvFile2 = pd.read_csv('VulnerabilityLibrary/ParisWindstormVariant/keys_data/construction_dict.csv')  
df2 = pd.DataFrame(csvFile2).to_numpy()

csvFile3 = pd.read_csv('VulnerabilityLibrary/ParisWindstormVariant/keys_data/occupancy_dict.csv')  
df3 = pd.DataFrame(csvFile3).to_numpy()

vulnerability_dict =[]
vulnerability_id = 0
attribute2_id = 0
attribute6_id = 0 

for i in df1:
    
    vulnerability_id += 1
    peril_id = 'QEQ'
    
    for j in df2:
        if  i[0] == j[2]:
            attribute2_id = j[4]
    
    attribute4_id = i[2]
    
    for j in df3:
        if  i[1] == j[0]:
            attribute6_id = j[2]

    coverage_type = 1
    vulnerability_dict.append({'vulnerability_id': vulnerability_id, 'attribute2_id': attribute2_id, 'peril_id': peril_id, 'coverage_type': coverage_type,'attribute4_id': attribute4_id,'attribute6_id': attribute6_id})

    vulnerability_id += 1    
    
    coverage_type = 3
    vulnerability_dict.append({'vulnerability_id': vulnerability_id, 'attribute2_id': attribute2_id, 'peril_id': peril_id, 'coverage_type': coverage_type,'attribute4_id': attribute4_id,'attribute6_id': attribute6_id})
    

fields = ['vulnerability_id', 'attribute2_id' ,'peril_id', 'coverage_type', 'attribute4_id', 'attribute6_id'] 

with open('VulnerabilityLibrary/ParisWindstormVariant/keys_data/vulnerability_dict.csv', 'x') as csvfile:              
    # creating a csv dict writer object
    writer = csv.DictWriter(csvfile, fieldnames=fields)

    # writing headers (field names)
    writer.writeheader()

    # writing data rows
    writer.writerows(vulnerability_dict)
        


